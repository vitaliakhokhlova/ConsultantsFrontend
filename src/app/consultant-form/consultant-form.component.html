<div class="container" *ngIf="isPatched">
<form 
  [formGroup]="consultantForm" 
  (ngSubmit)="onSubmit()"
  novalidate
>
<table class="example-full-width" cellspacing="0"><tr>
  <td>
  <app-mat-datepicker  
    controlName="birthday"    
    placeholder="Date de naissance" 
    local="fr"
    [startDate]="consultantForm.value.birthday ? consultantForm.value.birthday :startDate"
  ></app-mat-datepicker>
</td>
<td>
<mat-form-field class="example-full-width">
<input 
matInput 
type="text" 
placeholder="Fichier de la photo" 
formControlName="photoname"
>
</mat-form-field>
</td>
<td>
  <mat-form-field class="example-full-width">
  <input 
  matInput 
  type="text" 
  placeholder="Mobilité" 
  formControlName="mobility"
  >
  </mat-form-field>
  </td></table>



  <div *ngFor="let lineInputs of simpleInputs">
  <table class="example-full-width" cellspacing="0"><tr>
    <td *ngFor="let lineInput of lineInputs">
      <mat-form-field class="example-full-width">
        <input 
          matInput 
          type="text" 
          [placeholder]="lineInput.placeholder" 
          [id]="lineInput.name" 
          [formControlName]="lineInput.name"
        >
        <control-messages [key]="lineInput.name"></control-messages>
      </mat-form-field>
    </td>
    </tr></table>
  </div>

  <mat-form-field class="example-full-width">
    <textarea 
    matInput
    cdkTextareaAutosize
    #autosize="cdkTextareaAutosize"
    cdkAutosizeMinRows="1"
    cdkAutosizeMaxRows="10"
    placeholder="Profile" 
    formControlName="profile"></textarea>
  </mat-form-field>

<br><br><br><br>

<h3>Forces cognitives (drag and drop)</h3>
<br><br>
<div formArrayName="forces">
  <app-mat-drag-and-drop
    [destination]="forces"
    [orderProperty]="['position']"
    [nameProperty]="['parent2','description']"
    [source]="forceItems"
  ></app-mat-drag-and-drop>
</div>
<br><br>

<h3>Langues</h3>
<div formArrayName="langues">
  <div  *ngFor="let langueConsultant of langues.controls; let i=index"  
  [formGroupName]="i">  
  <table cellspacing="0"><tr>
    <td>
    <div formGroupName="parent2"> 
      <app-mat-autocomplete
        controlName="description"
        [options] = "langueItems"
        placeholder = "Chercher et cliquer"
        property="description"
        (createNewOption)="createNewLanguage(langueConsultant)"
        >
      </app-mat-autocomplete>  
    </div>
  </td>
      <td>
    <mat-form-field  fxFlex="20%"> 
      <input 
        matInput 
        formControlName="niveau"
        placeholder="Niveau"
        [errorStateMatcher]="matcher" 
        required
      >
      <mat-error *ngIf="langueConsultant.controls.niveau.hasError('maxLength')">
        Max length 20 
      </mat-error>
      <mat-error *ngIf="langueConsultant.controls.niveau.hasError('required')">
        <strong>Required</strong>
      </mat-error>
    </mat-form-field> 
  </td>
  <td>
    <button 
    mat-button type="button" matSuffix mat-icon-button aria-label="Delete"
      (click)="delete(langues,i)">
      <mat-icon>delete_forever</mat-icon>
    </button>    
  </td>         
  </tr>  
  </table>
  </div>  
  <button mat-fab type="button" (click)="addLangue()">
    <i class="fas fa-plus-circle"></i>
  </button>  
</div>  

<br><br>

<div *ngFor="let arrayName of historyArraysNames; let i=index">
<h3>{{arrayName | titlecase}} </h3>
<div [formArrayName]="arrayName">
  <div 
    *ngFor="let item of consultantForm.get(arrayName).controls; let j=index" 
    [formGroupName]="j"
  >
    <app-reactive-form-array
      [properties]="historyObjectFields"
      [placeholders]="historyObjectPlaceholders" 
    >                
    </app-reactive-form-array> 

    <div *ngIf="isWithChildren[i]" formArrayName="details">
      <div 
        *ngFor="let detail of item.get('details').controls; let k=index" 
        [formGroupName]="k"
      >    
      <p style="margin-left: 200px">
        <app-reactive-form-array
          [properties]="['description']"
          [placeholders]="['Tâche']" 
        >                
        </app-reactive-form-array>  
      </p>

  </div>
  <p style="margin-left: 200px">
    <button mat-fab type="button" (click)="addDetail(item)">
      <i class="fas fa-plus-circle">Ajouter une tâche</i>   
    </button>    
  </p>
    </div>  
   
    </div>

  <button mat-fab type="button" (click)="addHistoryObjectWithChildren(arrayName,isWithChildren[i])">
    <i class="fas fa-plus-circle"></i>   
  </button>  
</div> 
<br><br>
</div>

<br>
<button 
  mdbBtn 
  color="primary" 
  type="button" 
  [disabled]="!consultantForm.valid"
  (click)="onSubmit(true)">
  Sauvegarder et ouvrir le formulaire de competences
</button>

  <button 
    mdbBtn 
    color="primary" 
    type="button" 
    [disabled]="!consultantForm.valid"
    (click)="onSubmit(false)"
    >
    Sauvegarder et voir le profile
  </button> 
</form>  

<ng-template #loading>
  Loading (check console for errors)...
</ng-template>
</div>
